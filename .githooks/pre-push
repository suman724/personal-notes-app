#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR=$(git rev-parse --show-toplevel)
cd "$ROOT_DIR"

echo "Running test suite..."
if ! npm run test; then
  echo "Tests failed. Push aborted." >&2
  exit 1
fi

if [ "${SKIP_DOCKER_BUILD:-}" = "1" ]; then
  echo "Skipping docker build (SKIP_DOCKER_BUILD=1)."
  exit 0
fi

if ! command -v docker >/dev/null 2>&1; then
  echo "Docker is required for pre-push checks. Install Docker or set SKIP_DOCKER_BUILD=1." >&2
  exit 1
fi

echo "Building Docker image..."
docker build -t personal-notes-app:local .
